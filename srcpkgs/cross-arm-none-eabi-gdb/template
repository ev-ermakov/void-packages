# Template file for 'cross-arm-none-eabi-gdb'
pkgname=cross-arm-none-eabi-gdb
version=10.1
revision=1
wrksrc=gdb-${version}
build_style=gnu-configure
configure_args="--disable-nls --with-system-readline --target=arm-none-eabi
 --with-system-gdbinit=/etc/gdb/gdbinit --with-system-zlib --without-isl
 $(vopt_if static 'CFLAGS=-static CXXFLAGS=-static LDFLAGS=-static')
 $(vopt_with guile) $(vopt_if python --with-python=/usr/bin/python3)"
hostmakedepends="pkg-config texinfo $(vopt_if python python3-devel) $(vopt_if guile guile)"
makedepends="expat-devel ncurses-devel readline-devel zlib-devel $(vopt_if guile guile-devel)
 $(vopt_if python python3-devel) babeltrace-devel mpfr-devel"
depends="gdb-common"
short_desc="GNU Debugger for ARM"
maintainer="Ivan Sokolov <ivan-p-sokolov@ya.ru>"
license="GPL-3.0-or-later"
homepage="https://www.gnu.org/software/gdb"
distfiles="${GNU_SITE}/gdb/gdb-${version}.tar.xz"
checksum=f82f1eceeec14a3afa2de8d9b0d3c91d5a3820e23e0a01bbb70ef9f0276b62c0
make_check=no  # See gdb/template.

if [ "${CROSS_BUILD}" ]; then
	# Make python3.x detection work in cross builds
	CFLAGS="-I${XBPS_CROSS_BASE}/${py3_inc}"
	CXXFLAGS="-I${XBPS_CROSS_BASE}/${py3_inc}"
	makedepends+=" libatomic_ops-devel" # guile
fi

# Package build options
build_options="static guile python"
build_options_default="python"

post_install() {
	# resolve conflicts with gdb-common
	rm -rf ${DESTDIR}/usr/{share/{gdb,info},include}
}
