# Template file for 'cross-arm-none-eabi-gdb'
pkgname=cross-arm-none-eabi-gdb
version=10.2
revision=1
wrksrc=gdb-${version}
build_style=gnu-configure
configure_args="--target=arm-none-eabi --disable-werror --disable-nls --with-system-readline
 --with-system-gdbinit=/etc/gdb/gdbinit --with-system-zlib --without-isl
 $(vopt_with guile) $(vopt_if python --with-python=/usr/bin/python3)"
hostmakedepends="pkg-config texinfo $(vopt_if python python3-devel) $(vopt_if guile guile)"
makedepends="expat-devel ncurses-devel readline-devel zlib-devel $(vopt_if guile guile-devel)
 $(vopt_if python 'python3-devel gettext-devel') babeltrace-devel mpfr-devel"
depends="gdb-common"
short_desc="GNU Debugger for ARM"
maintainer="Ivan Sokolov <ivan-p-sokolov@ya.ru>"
license="GPL-3.0-or-later"
homepage="https://www.gnu.org/software/gdb"
distfiles="${GNU_SITE}/gdb/gdb-${version}.tar.xz"
checksum=aaa1223d534c9b700a8bec952d9748ee1977513f178727e1bee520ee000b4f29
make_check=no  # See gdb/template.
patch_args="-Np1"

if [ "${CROSS_BUILD}" ]; then
	# Make python3.x detection work in cross builds
	CFLAGS="-I${XBPS_CROSS_BASE}/${py3_inc}"
	CXXFLAGS="-I${XBPS_CROSS_BASE}/${py3_inc}"
fi

# Package build options
build_options="guile python"
build_options_default="python"

post_install() {
	# resolve conflicts with gdb-common
	rm -r ${DESTDIR}/usr/{share/{gdb,info},include}
}
